
:- table nw_activation_from_yw_step/5.
nw_activation_from_yw_step(ActivationId, FunctionName, StepId, StepName, ActivationLine) :-
    nw_function_activation(ActivationId, _, FunctionName, ActivationLine, _),
    yw_workflow_step(StepId, StepName, _, _,  StepBeginLine, StepEndLine),
    line_inside_range(ActivationLine, StepBeginLine, StepEndLine).

:- table nw_activation_into_yw_program/6.
nw_activation_into_yw_program(ActivationId, FunctionName, StepId, StepName, ActivationLine, CallerActivationId) :-
    yw_program(StepId, StepName, _, _,  StepBeginLine, StepEndLine),
    nw_function_activation(ActivationId, _, FunctionName, ActivationLine, CallerActivationId),
    line_outside_range(ActivationLine, StepBeginLine, StepEndLine),
    nw_function_definition(_, FunctionName, FunctionStartLine, _, _),
    line_inside_range(FunctionStartLine, StepBeginLine, StepEndLine).

:- table nw_activation_into_yw_step_subprogram/2.
nw_activation_into_yw_step_subprogram(ActivationId, StepId) :-
    nw_activation_into_yw_program(ActivationId, _, StepId, _, _, _),
    nw_activation_into_yw_program(ActivationId, _, SubprogramId, _, _, _),
    yw_workflow_step(SubprogramId, _, StepId, _, _, _).

:- table nw_activation_into_yw_step/6.
nw_activation_into_yw_step(ActivationId, FunctionName, StepId, StepName, ActivationLine, CallerActivationId) :-
    nw_activation_into_yw_program(ActivationId, FunctionName, StepId, StepName, ActivationLine, CallerActivationId),
    not nw_activation_into_yw_step_subprogram(ActivationId, StepId).

:- table nw_variable_for_yw_in_port/10.
nw_variable_for_yw_in_port(VariableId, VariableName, VariableValue, DataId, DataName, Type, PortId, PortName, StepId, StepName) :-
    nw_variable_for_yw_in_port(VariableId, VariableName, VariableValue, DataId, DataName, PortId, PortName, StepId, StepName),
    Type = variable.
nw_variable_for_yw_in_port(VariableId, VariableName, VariableValue, DataId, DataName, Type, PortId, PortName, StepId, StepName) :-
    nw_argument_for_yw_in_port(VariableId, VariableName, VariableValue, DataId, DataName, PortId, PortName, StepId, StepName),
    Type = argument.

:- table nw_variable_for_yw_out_port/9.
% Output variables assigned inside the step then used outside the step.
nw_variable_for_yw_out_port(VariableId, VariableName, VariableValue, DataId, DataName, PortId, PortName, StepId, StepName) :-
    yw_step_output(StepId, _, _, PortId, PortName, DataId, DataName),
    PortName = VariableName,
    nw_variable_assigned_in_yw_step(VariableId, VariableName, VariableValue, StepId, StepName, _),
    nw_variable_used_outside_yw_step(VariableId, _, _, StepId, _, _).
% Output variables that are input variables with names matching outputs and no matching assignments in step.
nw_variable_for_yw_out_port(VariableId, VariableName, VariableValue, DataId, DataName, PortId, PortName, StepId, StepName) :-
    PortName = VariableName,
    yw_step_output(StepId, StepName, _, PortId, PortName, DataId, DataName),
    nw_variable_for_yw_in_port(VariableId, VariableName, VariableValue, _, _, _, _, _, StepId, _),
    not nw_variable_assigned_in_yw_step(_, VariableName, _, StepId, _, _).

:- table nw_variable_for_yw_data/5.
nw_variable_for_yw_data(VariableId, VariableName, VariableValue, DataId, DataName) :-
    nw_variable_for_yw_in_port(VariableId, VariableName, VariableValue, DataId, DataName, _, _, _, _, _).
nw_variable_for_yw_data(VariableId, VariableName, VariableValue, DataId, DataName) :-
    nw_variable_for_yw_out_port(VariableId, VariableName, VariableValue, DataId, DataName, _, _, _, _).
